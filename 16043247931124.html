<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
    第一天 - NCDHZ
    
    </title>
    

    
    
    <link href="atom.xml" rel="alternate" title="NCDHZ" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/style.min.css">
    <link rel="stylesheet" href="asset/css/doc.css">
    <script src="asset/app.js"></script>
</head>
  <body>
    <section class="hero">
      <div class="hero-head">
          <nav class="navbar" role="navigation" aria-label="main navigation">
              <div class="container">
              <div class="navbar-brand">
                
                <a target="_self" class="navbar-item " href="https://www.majunlong.top">个人网站</a>
                
                <a target="_self" class="navbar-item " href="index.html">Home</a>
                
                <a target="_self" class="navbar-item " href="archives.html">Archives</a>
                

                <a role="button" id="navbarSNSRssSwitchBtn" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarSNSRssButtons">
                  <span aria-hidden="true"></span>
                  <span aria-hidden="true"></span>
                  <span aria-hidden="true"></span>
                </a>
              </div>
            
              <div id="navbarSNSRssButtons" class="navbar-menu">
                <div class="navbar-start">
                  
                </div>
            
                <div class="navbar-end">
                  <div class="navbar-item">
                    <!--buttons start-->
                    <div class="buttons">
                      
                        
                        
                        
                        <a href="https://github.com/ncdhz" target="_blank" title="github">
                            <span class="icon is-large has-text-grey-darker">
                               <svg class="svg-inline--fa fa-github fa-w-16 fa-lg" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-github fa-lg"></i> -->
                            </span>
                          </a>
                        
                        
                      
                      <a href="atom.xml" target="_blank" title="RSS">
                          <span class="icon is-large has-text-black-bis">
                              <svg class="svg-inline--fa fa-rss fa-w-14 fa-lg" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg><!-- <i class="fas fa-rss fa-lg"></i> -->
                          </span>
                      </a>
                    </div>
                    <!--buttons end-->

                  </div>
                </div>
                </div>
              </div>
            </nav>
      </div>

 <div class="hero-body ct-body"></div>
      
    </section>
    <section class="ct-body">
      <div class="container">
          <div class="columns is-variable bd-klmn-columns is-4 is-centered">
              <div class="column is-four-fifths">
                  <div class="post-body single-content">
                    
                    <h1 class="title">
                            第一天   
                      </h1>
                     
                    
                      <div class="media">
                            
                            <figure class="media-left">
                              <p class="image is-48x48">
                                
                                  <img class="is-rounded" src="">
                                
                              </p>
                            </figure>
                            
                            <div class="media-content">
                              <div class="content">
                                <p>
                                 <span class="date">2020/11/02</span>
                                  <span class="tran-posted-in">posted in</span>&nbsp; 
                                  
                                      <span class="posted-in"><a href='30%E5%A4%A9%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html'>30天自制操作系统</a></span>
                                         
                                  

                                   
                                      
                                  <br />
                                  <span class="tran-tags">Tags:</span>&nbsp;
                                  
                                    <a class="tag is-link is-light" href='tag_%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.html'>#自制操作系统</a>
                                     

                                </p>
                              </div>
                            </div>
                         
                    </div>
                </div>
                  <article class="markdown-body single-content">
                    <h3 id="toc_0">说明：基于Mac环境</h3>

<ol>
<li><p>下载软件</p>
<ul>
<li><code>HexFiend</code> 直接在<code>Mac</code>商店下载</li>
<li><p>下载 <code>QEMU</code> 虚拟机</p>
<p>Homebrew:</p>
<pre><code class="language-text">brew install qemu
</code></pre>
<p>MacPorts:</p>
<pre><code class="language-text">sudo port install qemu
</code></pre></li>
</ul></li>
<li><p>编写<code>Hello World</code></p>
<ul>
<li>打开<code>HexFiend</code></li>
<li>以下没有提及的地方数据全部填0</li>
<li><p>000000-000080 添加如下数据</p>
<pre><code class="language-text">EB4E9048 454C4C4F 49504C00 02010100 02E00040 0BF00900 12000200 00000000 400B0000 000029FF FFFFFF48 454C4C4F 2D4F5320 20204641 54313220 20200000 00000000 00000000 00000000 00000000 B800008E D0BC007C 8ED88EC0 BE747C8A 0483C601 3C007409 B40EBB0F 00CD10EB EEF4EBFD 0A0A6865 6C6C6F2C 20776F72 6C640A00 00000000 00000000 00000000
</code></pre>
<p><img src="media/16043247931124/16043255427586.jpg" alt=""/></p></li>
<li><p>0001F0-000200 添加如下数据</p>
<pre><code class="language-text">00000000 00000000 00000000 000055AA F0FFFFFF FFFFFFFF FF000000 00000000
</code></pre>
<p><img src="media/16043247931124/16043256591464.jpg" alt=""/></p></li>
<li><p>001400 添加如下数据</p>
<pre><code class="language-text">F0FFFFFF FFFFFFFF FF000000 00000000
</code></pre>
<p><img src="media/16043247931124/16043257563892.jpg" alt=""/></p></li>
<li><p>到 167FF0 为止</p>
<p><img src="media/16043247931124/16043262337415.jpg" alt=""/></p></li>
<li><p>保存上面的文件 <code>helloos.img</code></p></li>
<li><p>如果愿意编写可以通过<a href="https://github.com/ncdhz/os-study/blob/main/day01/helloos.img">此链接</a>下载</p>
<p><img src="media/16043247931124/16043268837991.jpg" alt=""/></p></li>
</ul></li>
<li><p>运行第一个操作系统 </p>
<ul>
<li><p>执行命令 <code>qemu-system-i386 -hdd helloos.img</code> 如果没有找到 <code>qemu-system-i386</code> 命令就是刚才下载 <code>qemu</code> 没有配置环境变量（通过<code>brew info qemu</code>找到路径然后自行配置环境变量）</p>
<p><img src="media/16043247931124/16043265333431.jpg" alt=""/></p>
<p><img src="media/16043247931124/16043265430228.jpg" alt=""/></p></li>
</ul></li>
</ol>

<h2 id="toc_1">原理解释</h2>

<p>到这里为止已经开发好了一个可以用虚拟机（真实的机器也可以）跑的程序了，不过还并不知道上面书写的是什么意思和对于我们来说意味着什么。可以先做以下的理解：上面的程序就是用16进制写了一个软盘格式文件（就像任何语言都有自己特定的格式），并且能够输出 <code>hello world</code>。这意味着我们已经可以做到电脑启动时就能自动加载我们书写的代码，听上去没有什么高级的，但是这好像就是做操作系统最开始的一步吧。注意：整个文件的大小必须是 <code>1474560</code> 字节，刚好为一个3.5寸软盘大小。</p>

<h2 id="toc_2">通过汇编的方式完成上面的程序</h2>

<ol>
<li><p>下载 <code>nasm</code> 汇编编译器</p>
<pre><code class="language-text">brew install nasm
</code></pre></li>
<li><p>编写如下汇编程序</p>
<pre><code class="language-nasm">; hello-os
; TAB=4<br/>
; 标展FAT12格式软盘专用的代码 Stand FAT12 format floppy code<br/>
    DB      0xeb, 0x4e, 0x90      ;<br/>
    DB      &quot;HELLOIPL&quot;            ; 启动扇区名称（8字节）<br/>
    DW      512                   ; 每个扇区（sector）大小（必须512字节）<br/>
    DB      1                     ; 簇（cluster）大小（必须为1个扇区）<br/>
    DW      1                     ; FAT起始位置（一般为第一个扇区）<br/>
    DB      2                     ; FAT个数（必须为2）<br/>
    DW      224                   ; 根目录大小（一般为224项）<br/>
    DW      2880                  ; 该磁盘大小（必须为2880扇区1440*1024/512）<br/>
    DB      0xf0                  ; 磁盘类型（必须为0xf0）<br/>
    DW      9                     ; FAT的长度（必须是9扇区）<br/>
    DW      18                    ; 一个磁道（track）有几个扇区（必须为18）<br/>
    DW      2                     ; 磁头数（必须是2）<br/>
    DD      0                     ; 不使用分区，必须是0<br/>
    DD      2880                  ; 重写一次磁盘大小<br/>
    DB      0,0,0x29              ; 意义不明（固定）<br/>
    DD      0xffffffff            ; （可能是）卷标号码<br/>
    DB      &quot;HELLO-OS   &quot;         ; 磁盘的名称（必须为11字节，不足填空格<br/>
    DB      &quot;FAT12   &quot;            ; 磁盘格式名称（必须是8字节，不足填空格）<br/>
    RESB    18                    ; 先空出18字节<br/>
; 程序主体<br/>
    DB      0xb8, 0x00, 0x00, 0x8e, 0xd0, 0xbc, 0x00, 0x7c<br/>
    DB      0x8e, 0xd8, 0x8e, 0xc0, 0xbe, 0x74, 0x7c, 0x8a<br/>
    DB      0x04, 0x83, 0xc6, 0x01, 0x3c, 0x00, 0x74, 0x09<br/>
    DB      0xb4, 0x0e, 0xbb, 0x0f, 0x00, 0xcd, 0x10, 0xeb<br/>
    DB      0xee, 0xf4, 0xeb, 0xfd<br/>
; 信息显示部分<br/>
    DB      0x0a, 0x0a      ; 换行两次<br/>
    DB      &quot;hello, world&quot;<br/>
    DB      0x0a            ; 换行<br/>
    DB      0<br/>
    RESB    0x1fe-($-$$)    ; 填写0x00直到0x001fe<br/>
    DB      0x55, 0xaa<br/>
; 启动扇区以外部分输出<br/>
    DB      0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00<br/>
    RESB    4600<br/>
    DB      0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00<br/>
    RESB    1469432
</code></pre></li>
<li><p>执行下面语句构建 <code>img</code> 软盘</p>
<pre><code class="language-text">nasm -f bin helloos.asm -o helloos.img
# 其中 helloos.asm 是刚才新建的文件 helloos.img 是生成的文件
</code></pre></li>
<li><p>和上面一样用虚拟机运行软盘</p>
<pre><code class="language-text">qemu-system-i386 -hdd helloos.img
</code></pre>
<p><img src="media/16043247931124/16043350118437.jpg" alt=""/></p></li>
</ol>

                  </article>
                  <div class="comments-wrap">
                    <div class="share-comments">
                      

                      

                      
                    </div>
                  </div><!-- end comments wrap -->
              </div>
            </div><!-- end columns -->
      </div><!-- end container -->
    </section>



    <footer class="footer">
        <div class="content has-text-centered">
          <p>
              Copyright &copy; 2019
              Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
              Theme used <a target="_blank" href="https://bulma.io/">Bulma CSS</a>.
          </p>
        </div>
      </footer>



  













<script src="asset/prism.js"></script>



  
    




  </body>
</html>
